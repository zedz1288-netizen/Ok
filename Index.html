<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Will You Be My Valentine?</title>
  <style>
    :root{
      --bg: #fffafb;
      --pink:#d63384;
      --yes:#4CAF50;
      --no:#ff4d4d;
      --muted:#888;
    }

    html,body{height:100%}
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container {
      max-width: 420px;
      padding: 20px;
    }

    .sticker {
      width: 150px;
      margin-bottom: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    h1 {
      color: var(--pink);
      font-size: 24px;
      margin: 0.3em 0;
    }

    .btn-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    button {
      padding: 10px 25px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
      font-size: 1rem;
    }

    .yes-btn { background-color: var(--yes); color: white; }
    .no-btn { background-color: var(--no); color: white; }
    .back-btn { background-color: var(--muted); color: white; margin-top: 20px; }

    .hidden { display: none; }

    .gift-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    /* gift-box is now a semantic button to be keyboard accessible */
    .gift-box {
      font-size: 40px;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
      background: transparent;
      border: none;
      padding: 8px;
      border-radius: 12px;
      line-height: 1;
    }

    .gift-box:hover,
    .gift-box:focus {
      transform: scale(1.2);
      outline: 3px solid rgba(214,51,132,0.15);
    }

    /* respect user preference for reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .gift-box,
      button {
        transition: none;
      }
      .gift-box:hover,
      .gift-box:focus {
        transform: none;
      }
    }

    #playback-error { color: #cc0000; margin-top: 12px; display:none; font-size:0.95em; }
    #manualPlayBtn { margin-top: 8px; display:none; background:#4CAF50; color:white; padding:8px 16px; border-radius:16px; border:none; cursor:pointer; }

    /* visually-hidden helper for accessible labels if needed */
    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap;
    }
  </style>
</head>
<body>

  <!-- Page 1 -->
  <main id="page1" class="container" role="region" aria-labelledby="heading-main">
    <svg class="sticker" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="heartTitle" focusable="false">
      <title id="heartTitle">Heart sticker</title>
      <path fill="#ff6b9a" d="M47.6 6c-5.1 0-9.7 2.8-12.1 6.9C32.1 8.8 27.5 6 22.4 6 12.3 6 4 14.3 4 24.4 4 39 27 53 32 58c5-5 28-19 28-33.6C60 14.3 51.7 6 41.6 6z"/>
    </svg>

    <h1 id="heading-main">Will You Be My Valentine?</h1>

    <div class="btn-group" role="group" aria-label="Answer options">
      <button class="yes-btn" onclick="acceptYes()" aria-label="Yes, I will be your valentine">Yes</button>
      <!-- Add touchstart handler and keyboard support in script -->
      <button class="no-btn" id="noBtn" aria-label="No, I do not accept" onmouseover="moveNoButton()">No</button>
    </div>
  </main>

  <!-- Page No -->
  <section id="page-no" class="container hidden" role="region" aria-labelledby="heading-no">
    <svg class="sticker" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="noTitle" focusable="false">
      <title id="noTitle">Sad face sticker</title>
      <circle cx="32" cy="32" r="30" fill="#ffeef0"/>
      <path d="M20 24c2 4 6 6 12 6s10-2 12-6" fill="none" stroke="#d63384" stroke-width="2" stroke-linecap="round"/>
      <circle cx="24" cy="24" r="3" fill="#d63384"/>
      <circle cx="40" cy="24" r="3" fill="#d63384"/>
    </svg>

    <h1 id="heading-no">I don't accept No as an answer!</h1>
    <button class="back-btn" onclick="nextPage('page1')">Go Back</button>
  </section>

  <!-- Gifts page -->
  <section id="page-gifts" class="container hidden" role="region" aria-labelledby="heading-gifts">
    <svg class="sticker" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="giftsTitle" focusable="false">
      <title id="giftsTitle">Gifts sticker</title>
      <rect x="8" y="20" width="48" height="28" rx="3" fill="#ffdede"/>
      <path d="M32 20v-8" stroke="#ff6b9a" stroke-width="4" stroke-linecap="round"/>
      <path d="M20 20c0-6 6-8 12-8s12 2 12 8" fill="none" stroke="#ff6b9a" stroke-width="3" stroke-linecap="round"/>
    </svg>

    <h1 id="heading-gifts">Choose a Gift!</h1>
    <div class="gift-container" role="list">
      <button class="gift-box" role="listitem" onclick="showReward('flowers')" aria-label="Open the flowers gift" title="Flowers">üéÅ</button>
      <button class="gift-box" role="listitem" onclick="showReward('music')" aria-label="Open the music gift" title="Music">üéÅ</button>
      <button class="gift-box" role="listitem" onclick="showReward('letter')" aria-label="Open the letter gift" title="Letter">üéÅ</button>
    </div>
  </section>

  <!-- Reward page -->
  <section id="reward-page" class="container hidden" role="region" aria-labelledby="heading-reward">
    <div id="reward-content"></div>
    <button class="back-btn" onclick="nextPage('page-gifts')">Go Back</button>
  </section>

  <!-- Audio element for the song.
       IMPORTANT: You must add the MP3 file yourself (see instructions below).
       Default path: assets/about_you_the_1975.mp3
  -->
  <audio id="song" preload="none" src="assets/about_you_the_1975.mp3"></audio>

  <div id="playback-error" role="status" aria-live="polite"></div>
  <button id="manualPlayBtn" onclick="manualPlay()" aria-hidden="true">Play song</button>

  <script>
    function nextPage(pageId) {
      document.querySelectorAll('.container, section, main').forEach(page => {
        page.classList.add('hidden');
      });
      const el = document.getElementById(pageId);
      if (el) {
        el.classList.remove('hidden');
        // Move focus to the region heading for better screen reader context
        const heading = el.querySelector('h1, [aria-labelledby]');
        if (heading && typeof heading.focus === 'function') {
          heading.setAttribute('tabindex', '-1');
          heading.focus({preventScroll: true});
        }
      }
    }

    function moveNoButton() {
      // playful redirect on hover/touch
      nextPage('page-no');
    }

    function showReward(type) {
      const content = document.getElementById('reward-content');
      nextPage('reward-page');

      if (type === 'flowers') {
        content.innerHTML = `
          <div style="font-size:1.1em;">
            <div style="font-size:72px;">üíê</div>
            <h3>Got This For You &lt;3</h3>
            <p>Sweet treats and flowers!</p>
          </div>
        `;
      } else if (type === 'music') {
        content.innerHTML = `
          <div style="font-size:1.1em;">
            <div style="font-size:72px;">üéµ</div>
            <h3>A song for you...</h3>
            <p>Playing: "About You" ‚Äî The 1975</p>
          </div>
        `;
        // Try to play when user explicitly chose music
        playSong().catch(err => {
          console.warn('Playback failed:', err);
          // UI already handled by playSong catch in acceptYes / manualPlay fallback
        });
      } else {
        content.innerHTML = `
          <div style="font-size:1.1em;">
            <div style="font-size:72px;">üíå</div>
            <h3>A Note for You</h3>
            <p style="font-style: italic; font-size: 0.95em;">"In your eyes, I have found a home..."</p>
          </div>
        `;
      }

      // Move focus to reward content for screen readers
      const first = content.querySelector('h3');
      if (first) {
        first.setAttribute('tabindex', '-1');
        first.focus({preventScroll:true});
      }
    }

    function acceptYes() {
      // Navigate first to provide instant feedback (counts as user gesture)
      nextPage('page-gifts');

      playSong().then(() => {
        console.log('Playback started');
      }).catch(err => {
        const errEl = document.getElementById('playback-error');
        errEl.textContent = 'Could not start audio playback automatically. Tap "Play song" to start the music.';
        errEl.style.display = 'block';
        const btn = document.getElementById('manualPlayBtn');
        btn.style.display = 'inline-block';
        btn.setAttribute('aria-hidden', 'false');
        console.warn('Playback error:', err);
      });
    }

    async function playSong() {
      const audio = document.getElementById('song');
      if (!audio) return Promise.reject(new Error('Audio element not found'));

      try {
        // Load the audio if it's not ready
        if (audio.readyState === 0) audio.load();
      } catch (e) {
        console.warn('Audio load failed:', e);
      }

      const playPromise = audio.play();
      if (playPromise !== undefined) {
        await playPromise; // will reject if playback is blocked
      }
    }

    function manualPlay() {
      playSong().then(() => {
        document.getElementById('playback-error').style.display = 'none';
        const btn = document.getElementById('manualPlayBtn');
        btn.style.display = 'none';
        btn.setAttribute('aria-hidden', 'true');
      }).catch(err => {
        const errEl = document.getElementById('playback-error');
        errEl.textContent = 'Playback still blocked. Try tapping the page or check the audio file/path.';
        errEl.style.display = 'block';
        console.warn('Manual play failed:', err);
      });
    }

    // Accessibility / keyboard: allow pressing 'y' to accept
    document.addEventListener('keydown', (e) => {
      if (e.key === 'y' || e.key === 'Y') acceptYes();
    });

    // Add touch support and keyboard support for the No button
    (function enhanceNoButton(){
      const noBtn = document.getElementById('noBtn');
      if (!noBtn) return;

      // Touchstart triggers same playful behavior as hover
      noBtn.addEventListener('touchstart', (ev) => {
        // Prevent the default so that the button doesn't receive a "click" after touch on some browsers
        ev.preventDefault();
        moveNoButton();
      }, {passive:false});

      // Keyboard support: Enter or Space should trigger moveNoButton
      noBtn.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          moveNoButton();
        }
      });
    })();

    // Ensure gift-box buttons are keyboard operable (they are buttons so it's native).
    // Focus management: when showing a new page we focus the heading for screen reader context (done in nextPage()).
  </script>
</body>
</html>
